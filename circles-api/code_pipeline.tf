module "code_pipeline" {
  source                      = "./modules/code_pipeline"
  vpc_id                      = "${data.terraform_remote_state.circles_vpc.vpc_id}"
  repository_url              = "${module.ecs.repository_url}"
  region                      = "${var.aws_region}"
  project                     = "${var.project}"
  ecs_service_name            = "${module.ecs.service_name}"
  ecs_cluster_name            = "${module.ecs.cluster_name}"
  run_task_subnet_id          = "${module.networking.private_subnets_id[0]}"
  db_subnet_id                = "${module.rds.subnet_id}"
  run_task_security_group_ids = ["${module.networking.security_groups_ids}", "${module.ecs.security_group_id}"] #"${module.rds.db_access_sg_id}", 
  github_oauth_token          = "${var.circles_api_github_oauth_token}"
  github_branch               = "master"
  image_name                  = "${var.project}-ecr"
  database_name               = "${module.rds.db_name}"
  database_user               = "${module.rds.db_username}"
  database_host               = "${module.rds.db_host}"
  database_port               = "${module.rds.db_port}"
  database_password           = "${var.database_password}"
  private_key                 = "${var.private_key}"
  cognito_pool_id             = "${data.terraform_remote_state.circles_cognito.cognito_userpool_id}"
  cognito_client_id           = "${data.terraform_remote_state.circles_cognito.cognito_api_app_id}"
  cognito_pool_jwt_kid        = "${var.cognito_pool_jwt_kid}"
  cognito_pool_jwt_n          = "${var.cognito_pool_jwt_n}"
  cognito_test_username       = "${var.cognito_test_username}"
  cognito_test_password       = "${var.cognito_test_password}"
  android_platform_gcm_arn    = "${data.terraform_remote_state.circles_sns.gcm_platform_arn}"
  blockchain_network_id       = "${var.blockchain_network_id}"
}
